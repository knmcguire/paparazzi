<!DOCTYPE flight_plan SYSTEM "../flight_plan.dtd">

<flight_plan alt="1" ground_alt="0" lat0="51.990634" lon0="4.376789"
	max_dist_from_home="20" name="imav2017_cooperativecarry" security_height="0.4">
	<header>
		#include "autopilot.h"
		#include "subsystems/radio_control.h"
		#include "subsystems/ahrs.h"
		#include "subsystems/electrical.h"
		#include "subsystems/datalink/datalink.h"
	</header>
	<waypoints>
		<waypoint height="0" name="HOME" x="0.0" y="0.0" />
		<waypoint lat="51.9906873" lon="4.3768069" name="_DZ1" />
		<waypoint lat="51.9906496" lon="4.3767068" name="_DZ2" />
		<waypoint lat="51.9905876" lon="4.3767679" name="_DZ3" />
		<waypoint lat="51.9906254" lon="4.3768677" name="_DZ4" />
	</waypoints>
	<exceptions>
		<exception cond="datalink_time>=2" deroute="Force Kill Engines"/>
		<exception cond="radio_control.status == RC_REALLY_LOST" deroute="Force Kill Engines"/>
	</exceptions>
	<blocks>
		<block name="FPInit">
      		<while cond="!GpsFixValid()"/>
      		<while cond="1"/>
    	</block>
		<block name="Force Start Engines" strip_button="Takeoff" strip_icon="takeoff.png">
			<call_once fun="guidance_v_set_guided_th(0.2)"/>
     		<call_once fun="autopilot_set_motors_on(TRUE)"/>
        </block>
		<block name="Track Relative Position">
			<while cond="TRUE">
				<call fun="trackRelPos(1.5)"/>
			</while>
		</block>
		<block name="Fly Forward and Track">
			<while cond="TRUE">
				<call fun="setForwardAndTrack(0.3, 1.5)"/>
			</while>
            <exception cond="block_time>30" deroute="Track Relative Position"/>
		</block>
		<block name="Land" strip_button="Land Here" strip_icon="land-right.png">
			<call fun="goLand()"/>
			<deroute block="FPInit"/>
      		<while cond="1"/>
		</block>
		<block name="Force Kill Engines">
     		<call_once fun="autopilot_set_motors_on(FALSE)"/>
      		<while cond="1"/>
      	</block>
	</blocks>
</flight_plan>
